<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<style>
body { font-family: Arial, sans-serif; background-color: #470f18; color: #f1a140; }
header { display: flex; justify-content: space-between; align-items: center; text-align: center; margin: 10px; }
header img { width: 206px; }
.timers { font-size: 1.5em; }
.columns { display: flex; justify-content: space-around; margin: 20px; }
.team { border: 2px solid #b6c0c0; padding: 15px; border-radius: 10px; width: 45%; background: #5a1a24; text-align: left; }
.team h2 { color: #f0dcc0; text-align: center; }
.team input, .team select { margin: 5px; padding: 5px; }
button { margin: 5px; padding: 8px 16px; border: none; border-radius: 8px; background-color: #e44942; color: #fff; font-weight: bold; cursor: pointer; }
table { margin: 20px auto; border-collapse: collapse; background: #5a1a24; width: 90%; }
th, td { border: 1px solid #f0dcc0; padding: 8px; text-align: center; color: #f0dcc0; }
.team-sections { display: flex; justify-content: space-between; }
.team-section { width: 48%; }
#table td button { margin:0 auto; display:block; }
.buttons-container { display:flex; justify-content:center; gap:10px; margin:20px 0; }
</style>
</head>
<body>

<header>
<img src="MADBOTLogo.png" alt="MAD-BOT Logo">
<div class="timers">
<p>Tiempo de Partida: <span id="mainTimer">120</span> s</p>
<button onclick="startMain()">Iniciar</button>
<button onclick="resetMain()">Reset</button>
</div>
</header>

<div class="columns">
<!-- EQUIPO 1 -->
<div class="team">
<h2>Equipo 1</h2>
<label>Nombre: <input id="team1_name"></label>
<div class="team-sections">
<div class="team-section">
<h3>Reciclaje</h3>
Azul: <input type="number" id="blue1" min="0" max="3" value="0"><br>
Amarillo: <input type="number" id="yellow1" min="0" max="3" value="0"><br>
Verde: <input type="number" id="green1" min="0" max="3" value="0"><br>
Mal reciclados: <input type="number" id="misSorted1" min="0" value="0"><br>
</div>
<div class="team-section">
<h3>Reforestación</h3>
Árbol en el parque: 
<select id="trees1">
<option value="0">No</option>
<option value="25">Sí (25 pts)</option>
</select>
</div>
</div>
<h3>Otros</h3>
<label><input type="checkbox" id="finish1"> Acabar en zona FIN (10 pts)</label><br>
<label><input type="checkbox" id="allDrive1"> Todos conducen (15 pts)</label><br>
<h3>Total: <span id="total1">0</span> pts</h3>
<div style="text-align:right; margin-top:10px;"><button onclick="resetTeam(1)">Reset Equipo 1</button></div>
</div>

<!-- EQUIPO 2 -->
<div class="team">
<h2>Equipo 2</h2>
<label>Nombre: <input id="team2_name"></label>
<div class="team-sections">
<div class="team-section">
<h3>Reciclaje</h3>
Azul: <input type="number" id="blue2" min="0" max="3" value="0"><br>
Amarillo: <input type="number" id="yellow2" min="0" max="3" value="0"><br>
Verde: <input type="number" id="green2" min="0" max="3" value="0"><br>
Mal reciclados: <input type="number" id="misSorted2" min="0" value="0"><br>
</div>
<div class="team-section">
<h3>Reforestación</h3>
Árbol en el parque: 
<select id="trees2">
<option value="0">No</option>
<option value="25">Sí (25 pts)</option>
</select>
</div>
</div>
<h3>Otros</h3>
<label><input type="checkbox" id="finish2"> Acabar en zona FIN (10 pts)</label><br>
<label><input type="checkbox" id="allDrive2"> Todos conducen (15 pts)</label><br>
<h3>Total: <span id="total2">0</span> pts</h3>
<div style="text-align:right; margin-top:10px;"><button onclick="resetTeam(2)">Reset Equipo 2</button></div>
</div>
</div>

<div class="buttons-container">
<button id="save">Guardar Resultados</button>
<button id="export">Exportar CSV</button>
<button id="reset">Reiniciar Tabla</button>
</div>

<table id="table">
<thead>
<tr>
<th>Puesto</th><th>Equipo</th><th>Total</th><th>Acciones</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// Temporizador
let mainTimer = 120, intervalMain = null;
function beep(){ new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg").play(); }
function startMain(){
  if(intervalMain) return;
  intervalMain = setInterval(()=>{
    mainTimer--;
    document.getElementById("mainTimer").textContent = mainTimer;
    if(mainTimer <= 0){ clearInterval(intervalMain); intervalMain = null; beep(); }
  },1000);
}
function resetMain(){ clearInterval(intervalMain); intervalMain=null; mainTimer=120; document.getElementById("mainTimer").textContent=mainTimer; }

// Reset equipo
function resetTeam(team){
  document.getElementById("team"+team+"_name").value="";
  ["blue","yellow","green","misSorted"].forEach(id=>document.getElementById(id+team).value=0);
  document.getElementById("trees"+team).selectedIndex=0;
  ["finish","allDrive"].forEach(id=>document.getElementById(id+team).checked=false);
  document.getElementById("total"+team).textContent=0;
}

// Cálculo de puntuación
function calc(team){
  let blue = +document.getElementById("blue"+team).value;
  let yellow = +document.getElementById("yellow"+team).value;
  let green = +document.getElementById("green"+team).value;
  let mis = +document.getElementById("misSorted"+team).value;
  let rec = 0;
  [blue,yellow,green].forEach(c=>{
    if(c===1) rec+=2; else if(c===2) rec+=5; else if(c===3) rec+=15;
  });
  rec -= mis*5;
  if(blue>0 && yellow>0 && green>0) rec+=10; // bonus por clasificar los tres tipos
  let ref = +document.getElementById("trees"+team).value;
  let oth = 0;
  if(document.getElementById("finish"+team).checked) oth+=10;
  if(document.getElementById("allDrive"+team).checked) oth+=15;
  let total = rec + ref + oth;
  document.getElementById("total"+team).textContent = total;
  return total;
}

// Actualiza al cambiar cualquier input
document.querySelectorAll("input,select").forEach(el=>el.addEventListener("change",()=>{ calc(1); calc(2); }));

// Guardar y cargar resultados
function loadEntries(){ return JSON.parse(localStorage.getItem('madbot')||"[]"); }
function saveEntries(data){ localStorage.setItem('madbot',JSON.stringify(data)); }

function refreshTable(){
  let tb = document.querySelector("#table tbody"); 
  tb.innerHTML="";
  let data = loadEntries().sort((a,b)=>b.total-a.total);
  data.forEach((e,i)=>{
    let tr = document.createElement("tr");
    tr.innerHTML=`<td>${i+1}</td><td>${e.team}</td><td>${e.total}</td><td><button onclick="deleteRow(${i})">Borrar</button></td>`;
    tb.appendChild(tr);
  });
}

function deleteRow(index){
  let data = loadEntries(); data.splice(index,1); saveEntries(data); refreshTable();
}

// Botón Guardar
document.getElementById("save").onclick=()=>{
  [1,2].forEach(t=>{
    let teamName = document.getElementById("team"+t+"_name").value;
    if(teamName.trim()==="") return;
    let entry = { team:teamName, total: calc(t) };
    let data = loadEntries(); data.push(entry); saveEntries(data);
  });
  refreshTable();
};

// Exportar CSV
document.getElementById("export").onclick=()=>{
  let data = loadEntries();
  if(!data.length){ alert("No hay datos"); return; }
  let csv = "Puesto,Equipo,Total\n"+data.map((e,i)=>[i+1,e.team,e.total].join(",")).join("\n");
  let blob = new Blob([csv],{type:"text/csv"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download="madbot.csv";
  a.click();
};

// Reset tabla y equipos
document.getElementById("reset").onclick=()=>{
  localStorage.removeItem("madbot");
  refreshTable();
  resetTeam(1); resetTeam(2); resetMain();
};

// Inicialización
refreshTable(); calc(1); calc(2);
</script>
</body>
</html>
