<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>MAD-BOT Scoreboard</title>
<style>
  :root {
  --bg: #f1a140;
  --fg: #470f18;
  --table-bg: #d0d0d0;
  --card-bg: #d0d0d0;
  --accent: #e44942;
}
body {
  font-family: Arial, sans-serif;
  background-color: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
}

/* --- CABECERA --- */
header {
  display: table;
  width: 100%;
  margin-bottom: 20px;
}
.header-cell {
  display: table-cell;
  vertical-align: middle;
  text-align: center;
}
.header-left { text-align: left; width: 33%; }
.header-center { text-align: center; width: 34%; }
.header-right { text-align: right; width: 33%; }

header img {
  width: 200px;
}
.timers {
  font-size: 1.1rem;
}
.timers button {
  margin: 5px;
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  color: #fff;
  font-weight: 700;
  cursor: pointer;
}
.timers button:hover {
  opacity: 0.95;
}

/* --- COLUMNAS DE EQUIPOS --- */
.columns {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  justify-content: space-around;
}
.team {
  border: 2px solid var(--fg);
  padding: 14px;
  border-radius: 10px;
  width: 420px;
  background: var(--card-bg);
  box-sizing: border-box;
}
.team h2 {
  color: var(--fg);
  text-align: center;
  margin: 4px 0 10px;
}

/* --- Campos de nombre y reciclaje en la misma línea --- */
.team label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 4px 0;
}
.team label input {
  margin: 0;
  flex: 1; /* ocupa el resto del espacio disponible */
}

/* --- Checkboxes alineados a la izquierda --- */
.other-options {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 6px;
  margin-top: 4px;
}
.checkbox-label {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  white-space: nowrap;
  margin: 0;
}
.checkbox-label input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}

.team-sections {
  display: flex;
  gap: 12px;
}
.team-section { flex: 1; }

button {
  margin: 6px 4px 0 0;
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  color: #fff;
  font-weight: 700;
  cursor: pointer;
}
button.secondary {
  background: var(--fg);
  color: var(--bg);
}

/* --- BOTONES Y TABLAS --- */
.buttons-container {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin: 18px 0;
  flex-wrap: wrap;
}
table {
  margin: 10px auto 30px;
  border-collapse: collapse;
  width: 95%;
  max-width: 1100px;
  background: var(--table-bg);
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
th, td {
  border: 1px solid var(--fg);
  padding: 8px 10px;
  text-align: center;
  color: var(--fg);
}
th { background: var(--bg); }
#scoreboard-title {
  text-align: center;
  color: var(--fg);
  margin-top: 26px;
  font-size: 1.3rem;
}
.podium { font-size: 1.25rem; }
input.small { width: 70px; padding: 6px; }

@media (max-width:900px){
  .columns{flex-direction:column; align-items:center;}
  .team{width:92%;}
  table{width:98%;}
}
/* --- Campos de nombre y reciclaje en la misma línea --- */
.team label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 4px 0;
}
.team label input {
  margin: 0;
  flex: 1;
}

/* --- Excluir labels de Reforestación para que estén en bloque --- */
.team-section:last-child label {
  display: block;
}
.team-section:last-child label input,
.team-section:last-child label select {
  width: 100%;
  margin: 6px 0 0 0;
  flex: unset;
}

/* --- Columnas iguales --- */
.team-sections {
  display: flex;
  gap: 12px;
}
.team-section { 
  flex: 1;  /* columnas del mismo ancho */
}

/* --- Checkboxes alineados a la izquierda --- */
.other-options {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 6px;
  margin-top: 4px;
}
.checkbox-label {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  white-space: nowrap;
  margin: 0;
}
.checkbox-label input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}

</style>
</head>
<body>

<header>
  <div class="header-cell header-left"></div>
  <div class="header-cell header-center">
        <img src="https://lobotic.github.io/MAD-BOT/MADBOTLogo.png" alt="MAD-BOT Logo">
  </div>
  <div class="header-cell header-right">
    <div class="timers">
      <p>Tiempo de Partida: <span id="mainTimer">120</span> s</p>
      <button onclick="startMain()">Iniciar</button>
      <button onclick="resetMain()">Reset</button>
    </div>
  </div>
</header>

<!-- --- EQUIPOS --- -->
<div class="columns">
  <div class="team" id="teamBlock1">
    <h2>Equipo 1</h2>
    <label>Nombre: <input id="team1_name" placeholder="Nombre del equipo 1"></label>
    <div class="team-sections">
      <div class="team-section">
        <h3>Reciclaje</h3>
        <label>Azul: <input type="number" id="blue1" min="0" max="3" value="0"></label>
        <label>Amarillo: <input type="number" id="yellow1" min="0" max="3" value="0"></label>
        <label>Verde: <input type="number" id="green1" min="0" max="3" value="0"></label>
        <label>Mal reciclados: <input type="number" id="misSorted1" min="0" value="0"></label>
      </div>
      <div class="team-section">
        <h3>Reforestación</h3>
        <label>Árbol en el parque:
          <select id="trees1">
            <option value="0">No</option>
            <option value="25">Sí (25 pts)</option>
          </select>
        </label>
      </div>
    </div>
    <h3>Otros</h3>
    <div class="other-options">
      <label class="checkbox-label"><input type="checkbox" id="finish1">Acabar en zona FIN (10 pts)</label>
      <label class="checkbox-label"><input type="checkbox" id="allDrive1">Todos conducen (15 pts)</label>
    </div>
    <h3>Total: <span id="total1">0</span> pts</h3>
    <div style="text-align:right;margin-top:8px;"><button onclick="resetTeam(1)" class="secondary">Reset Equipo 1</button></div>
  </div>

  <div class="team" id="teamBlock2">
    <h2>Equipo 2</h2>
    <label>Nombre: <input id="team2_name" placeholder="Nombre del equipo 2"></label>
    <div class="team-sections">
      <div class="team-section">
        <h3>Reciclaje</h3>
        <label>Azul: <input type="number" id="blue2" min="0" max="3" value="0"></label>
        <label>Amarillo: <input type="number" id="yellow2" min="0" max="3" value="0"></label>
        <label>Verde: <input type="number" id="green2" min="0" max="3" value="0"></label>
        <label>Mal reciclados: <input type="number" id="misSorted2" min="0" value="0"></label>
      </div>
      <div class="team-section">
        <h3>Reforestación</h3>
        <label>Árbol en el parque:
          <select id="trees2">
            <option value="0">No</option>
            <option value="25">Sí (25 pts)</option>
          </select>
        </label>
      </div>
    </div>
    <h3>Otros</h3>
    <div class="other-options">
      <label class="checkbox-label"><input type="checkbox" id="finish2">Acabar en zona FIN (10 pts)</label>
      <label class="checkbox-label"><input type="checkbox" id="allDrive2">Todos conducen (15 pts)</label>
    </div>
    <h3>Total: <span id="total2">0</span> pts</h3>
    <div style="text-align:right;margin-top:8px;"><button onclick="resetTeam(2)" class="secondary">Reset Equipo 2</button></div>
  </div>
</div>

<!-- --- TABLAS --- -->
<div class="buttons-container">
  <button id="save">Guardar Resultados</button>
  <button id="export">Exportar CSV</button>
  <button id="reset">Reiniciar Tabla</button>
</div>

<h2 id="scoreboard-title">🏆 Clasificación de Rondas 🏆</h2>
<table id="table">
  <thead>
    <tr><th>Puesto</th><th>Equipo</th><th>Puntos</th><th>Acciones</th></tr>
  </thead>
  <tbody></tbody>
</table>

<h2 id="scoreboard-title">🏁 Puntuación Final 🏁</h2>
<table id="finalTable">
  <thead>
    <tr><th>Puesto</th><th>Podio</th><th>Equipo</th><th>Rondas</th><th>Total</th><th>Extra</th><th>Total + Extra</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
/* --- Temporizador --- */
let mainTimer = 120, intervalMain = null;
function beep(){try { new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg").play(); }catch(e){}}
function startMain(){if(intervalMain)return;beep();intervalMain=setInterval(()=>{mainTimer--;document.getElementById("mainTimer").textContent=mainTimer;if(mainTimer<=0){clearInterval(intervalMain);intervalMain=null;beep();}},1000);}
function resetMain(){clearInterval(intervalMain);intervalMain=null;mainTimer=120;document.getElementById("mainTimer").textContent=mainTimer;}
function resetTeam(t){["blue","yellow","green","misSorted"].forEach(id=>document.getElementById(id+t).value=0);["finish","allDrive"].forEach(id=>document.getElementById(id+t).checked=false);document.getElementById("trees"+t).selectedIndex=0;document.getElementById("team"+t+"_name").value="";document.getElementById("total"+t).textContent=0;}
function calc(t){let blue=+b("blue"+t),yellow=+b("yellow"+t),green=+b("green"+t),mis=+b("misSorted"+t);let rec=0;[blue,yellow,green].forEach(c=>{if(c===1)rec+=2;else if(c===2)rec+=5;else if(c===3)rec+=15;});rec-=mis*5;if(blue>0&&yellow>0&&green>0)rec+=10;let ref=+b("trees"+t),oth=0;if(q("finish"+t).checked)oth+=10;if(q("allDrive"+t).checked)oth+=15;let total=rec+ref+oth;q("total"+t).textContent=total;return total;}
function b(id){return +document.getElementById(id).value||0;}function q(id){return document.getElementById(id);}
document.querySelectorAll('.team input, .team select').forEach(el=>el.addEventListener('change',()=>{calc(1);calc(2);}));
/* --- Almacenamiento y tablas --- */
function loadEntries(){return JSON.parse(localStorage.getItem('madbot')||"[]");}
function saveEntries(d){localStorage.setItem('madbot',JSON.stringify(d));}
function loadExtras(){return JSON.parse(localStorage.getItem('madbot_extras')||"{}");}
function saveExtras(o){localStorage.setItem('madbot_extras',JSON.stringify(o));}
function refreshTable(){const tb=document.querySelector("#table tbody");tb.innerHTML="";const d=loadEntries().slice().sort((a,b)=>b.total-a.total);d.forEach((e,i)=>{const tr=document.createElement("tr");tr.innerHTML=`<td>${i+1}</td><td>${e.team}</td><td>${e.total}</td><td><button onclick="deleteRow(${i})" class="secondary">Borrar</button></td>`;tb.appendChild(tr);});}
function deleteRow(i){let d=loadEntries(),s=d.slice().sort((a,b)=>b.total-a.total);const del=s[i],orig=d.findIndex(x=>x.team===del.team&&x.total===del.total);if(orig>-1)d.splice(orig,1);saveEntries(d);refreshTable();renderFinalTable();}
q("save").onclick=()=>{const now=Date.now();let d=loadEntries();[1,2].forEach(t=>{const name=q("team"+t+"_name").value.trim();if(!name)return;d.push({team:name,total:calc(t),created:now});});saveEntries(d);refreshTable();renderFinalTable();};
q("export").onclick=()=>{let d=loadEntries();if(!d.length){alert("No hay datos");return;}d=d.slice().sort((a,b)=>b.total-a.total);const csv="Puesto,Equipo,Puntos,Fecha\n"+d.map((e,i)=>[i+1,e.team,e.total,new Date(e.created).toLocaleString()].join(",")).join("\n");const blob=new Blob([csv],{type:"text/csv"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="madbot_entries.csv";a.click();};
q("reset").onclick=()=>{if(!confirm("¿Borrar todos los datos?"))return;localStorage.removeItem('madbot');localStorage.removeItem('madbot_extras');refreshTable();renderFinalTable();resetTeam(1);resetTeam(2);resetMain();};
function renderFinalTable(){const tb=document.querySelector("#finalTable tbody");tb.innerHTML="";const data=loadEntries(),final={};data.forEach(e=>{if(!final[e.team])final[e.team]={team:e.team,total:0,rounds:0};final[e.team].total+=e.total;final[e.team].rounds++;});const extras=loadExtras();Object.keys(final).forEach(t=>final[t].extra=+extras[t]||0);let arr=Object.values(final).sort((a,b)=>(b.total+b.extra)-(a.total+a.extra));arr.forEach((e,i)=>{const podium=i==0?'🥇':i==1?'🥈':i==2?'🥉':'';const tr=document.createElement("tr");tr.innerHTML=`<td>${i+1}</td><td class="podium">${podium}</td><td>${e.team}</td><td>${e.rounds}</td><td>${e.total}</td><td><input class="small" type="number" value="${e.extra}" data-team="${e.team}"></td><td>${e.total+e.extra}</td>`;tb.appendChild(tr);});tb.querySelectorAll('input[data-team]').forEach(inp=>inp.addEventListener('change',()=>{const team=inp.dataset.team;const val=+inp.value||0;const ex=loadExtras();ex[team]=val;saveExtras(ex);renderFinalTable();}));}
refreshTable();renderFinalTable();calc(1);calc(2);
</script>
</body>
</html>
