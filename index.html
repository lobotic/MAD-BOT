<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<style>
body { font-family: Arial, sans-serif; background-color: #470f18; color: #f1a140; }
header { display: flex; justify-content: space-around; align-items: center; margin: 10px; }
header img { width: 206px; } /* 20% más grande */
.timers { font-size: 1.5em; display: flex; justify-content: space-around; width: 80%; }
.columns { display: flex; justify-content: space-around; margin: 20px; }
.team { border: 2px solid #b6c0c0; padding: 15px; border-radius: 10px; width: 45%; background: #5a1a24; text-align: left; }
.team h2 { color: #f0dcc0; text-align: center; }
.team input, .team select { margin: 5px; padding: 5px; }
button { margin: 5px; padding: 8px 16px; border: none; border-radius: 8px; background-color: #e44942; color: #fff; font-weight: bold; cursor: pointer; }
button.secondary { background-color: #b6c0c0; color: #000; }
table { margin: 20px auto; border-collapse: collapse; background: #5a1a24; width: 90%; }
th, td { border: 1px solid #f0dcc0; padding: 8px; text-align: center; color: #f0dcc0; }
.team-sections { display: flex; justify-content: space-between; }
.team-section { width: 48%; }
#table td button { margin:0 auto; display:block; }
.buttons-container { display:flex; justify-content:center; gap:10px; margin:20px 0; }
</style>
</head>
<body>

<header>
  <div class="timers">
    <div>
      <p>Preparación: <span id="prepTimer">30</span> s</p>
      <button onclick="startPrep()">Iniciar</button>
      <button onclick="resetPrep()">Reset</button>
    </div>
    <img src="MADBOTLogo.png" alt="MAD-BOT Logo">
    <div>
      <p>Tiempo de Partida: <span id="mainTimer">120</span> s</p>
      <button onclick="startMain()">Iniciar</button>
      <button onclick="resetMain()">Reset</button>
    </div>
  </div>
</header>

<div class="columns">
  <!-- Equipo 1 -->
  <div class="team">
    <h2>Equipo 1</h2>
    <label>Nombre: <input id="team1_name"></label><br>
    <label>Categoría: <select id="team1_cat"><option>Primaria</option><option>Secundaria</option></select></label>
    <label>Ronda: <input type="number" id="team1_round" value="1" min="1"></label>

    <div class="team-sections">
      <div class="team-section">
        <h3>Reciclaje</h3>
        Azul: <input type="number" id="blue1" min="0" max="3" value="0"><br>
        Amarillo: <input type="number" id="yellow1" min="0" max="3" value="0"><br>
        Verde: <input type="number" id="green1" min="0" max="3" value="0"><br>
        Mal reciclados: <input type="number" id="misSorted1" min="0" value="0"><br>
      </div>
      <div class="team-section">
        <h3>Reforestación</h3>
        Árboles colocados: 
        <select id="trees1"><option value="0">0</option><option value="1">1 árbol</option><option value="2">2 árboles</option></select><br>
        Diana 1: <select id="diana1a"><option value="0">Ninguna</option><option value="1">1 punto</option><option value="3">3 puntos</option><option value="5">5 puntos</option><option value="10">10 puntos</option><option value="20">20 puntos</option></select><br>
        Diana 2: <select id="diana1b"><option value="0">Ninguna</option><option value="1">1 punto</option><option value="3">3 puntos</option><option value="5">5 puntos</option><option value="10">10 puntos</option><option value="20">20 puntos</option></select>
      </div>
    </div>

    <h3>Otros</h3>
    <label><input type="checkbox" id="finish1"> Acabar en zona FIN (10 pts)</label><br>
    <label><input type="checkbox" id="allDrive1"> Todos conducen (15 pts)</label><br>
    <label><input type="checkbox" id="prepPenalty1"> Penalización por preparación (−15 pts)</label><br>
    <label><input type="checkbox" id="fallenTrees1"> Penalización por árboles caídos (−10 pts)</label><br>

    <h3>Total: <span id="total1">0</span> pts</h3>
    <div style="text-align:right; margin-top:10px;"><button onclick="resetTeam(1)">Reset Equipo 1</button></div>
  </div>

  <!-- Equipo 2 -->
  <div class="team">
    <h2>Equipo 2</h2>
    <label>Nombre: <input id="team2_name"></label><br>
    <label>Categoría: <select id="team2_cat"><option>Primaria</option><option>Secundaria</option></select></label>
    <label>Ronda: <input type="number" id="team2_round" value="1" min="1"></label>

    <div class="team-sections">
      <div class="team-section">
        <h3>Reciclaje</h3>
        Azul: <input type="number" id="blue2" min="0" max="3" value="0"><br>
        Amarillo: <input type="number" id="yellow2" min="0" max="3" value="0"><br>
        Verde: <input type="number" id="green2" min="0" max="3" value="0"><br>
        Mal reciclados: <input type="number" id="misSorted2" min="0" value="0"><br>
      </div>
      <div class="team-section">
        <h3>Reforestación</h3>
        Árboles colocados: 
        <select id="trees2"><option value="0">0</option><option value="1">1 árbol</option><option value="2">2 árboles</option></select><br>
        Diana 1: <select id="diana2a"><option value="0">Ninguna</option><option value="1">1 punto</option><option value="3">3 puntos</option><option value="5">5 puntos</option><option value="10">10 puntos</option><option value="20">20 puntos</option></select><br>
        Diana 2: <select id="diana2b"><option value="0">Ninguna</option><option value="1">1 punto</option><option value="3">3 puntos</option><option value="5">5 puntos</option><option value="10">10 puntos</option><option value="20">20 puntos</option></select>
      </div>
    </div>

    <h3>Otros</h3>
    <label><input type="checkbox" id="finish2"> Acabar en zona FIN (10 pts)</label><br>
    <label><input type="checkbox" id="allDrive2"> Todos conducen (15 pts)</label><br>
    <label><input type="checkbox" id="prepPenalty2"> Penalización por preparación (−15 pts)</label><br>
    <label><input type="checkbox" id="fallenTrees2"> Penalización por árboles caídos (−10 pts)</label><br>

    <h3>Total: <span id="total2">0</span> pts</h3>
    <div style="text-align:right; margin-top:10px;"><button onclick="resetTeam(2)">Reset Equipo 2</button></div>
  </div>
</div>

<div class="buttons-container">
  <button id="save">Guardar Resultados</button>
  <button id="export">Exportar CSV</button>
  <button id="reset">Reiniciar Tabla</button>
  <button id="finalScoresBtn">Puntuación Final</button>
</div>

<!-- Tabla de resultados por ronda -->
<table id="table">
  <thead>
    <tr>
      <th>Puesto</th><th>Equipo</th><th>Categoría</th><th>Ronda</th><th>Total</th><th>Acciones</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Tabla de puntuación final acumulada -->
<table id="finalTable">
  <thead>
    <tr>
      <th>Puesto</th><th>Equipo</th><th>Categoría</th><th>Rondas</th><th>Total</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let mainTimer=120, intervalMain=null;
let prepTimer=30, intervalPrep=null;

function beep(){ new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg").play(); }

function startMain(){ if(intervalMain) return; intervalMain=setInterval(()=>{ mainTimer--; document.getElementById("mainTimer").textContent=mainTimer; if(mainTimer<=0){ clearInterval(intervalMain); intervalMain=null; beep(); } },1000);}
function resetMain(){ clearInterval(intervalMain); intervalMain=null; mainTimer=120; document.getElementById("mainTimer").textContent=mainTimer; resetTeam(1); resetTeam(2); resetPrep(); }

function startPrep(){ if(intervalPrep) return; intervalPrep=setInterval(()=>{ if(prepTimer>0){ prepTimer--; document.getElementById("prepTimer").textContent=prepTimer; if(prepTimer===0) beep(); } else { clearInterval(intervalPrep); intervalPrep=null; } },1000);}
function resetPrep(){ clearInterval(intervalPrep); intervalPrep=null; prepTimer=30; document.getElementById("prepTimer").textContent=prepTimer; ["prepPenalty1","prepPenalty2"].forEach(id=>document.getElementById(id).checked=false); calc(1); calc(2); }

function resetTeam(team){ 
  document.getElementById("team"+team+"_name").value=""; 
  document.getElementById("team"+team+"_cat").selectedIndex=0; 
  document.getElementById("team"+team+"_round").value=1; 
  ["blue","yellow","green","misSorted"].forEach(id=>{ let el=document.getElementById(id+team); if(el) el.value=0; });
  ["trees","diana"+team+"a","diana"+team+"b"].forEach(id=>{ let el=document.getElementById(id); if(el) el.selectedIndex=0; });
  ["finish","allDrive","prepPenalty","fallenTrees"].forEach(id=>{ let el=document.getElementById(id+team); if(el) el.checked=false; });
  document.getElementById("total"+team).textContent=0;
}

function calc(team){
  let blue=+document.getElementById("blue"+team).value;
  let yellow=+document.getElementById("yellow"+team).value;
  let green=+document.getElementById("green"+team).value;
  let mis=+document.getElementById("misSorted"+team).value;
  let rec=0; [blue,yellow,green].forEach(c=>{ if(c===1) rec+=2; else if(c===2) rec+=5; else if(c===3) rec+=15; }); rec -= mis*5;
  if(blue>0 && yellow>0 && green>0) rec+=10;
  let trees=+document.getElementById("trees"+team).value;
  let ref=(trees===1?5:trees===2?15:0)+ +document.getElementById("diana"+team+"a").value + +document.getElementById("diana"+team+"b").value;
  let oth=0;
  if(document.getElementById("finish"+team).checked) oth+=10;
  if(document.getElementById("allDrive"+team).checked) oth+=15;
  if(document.getElementById("prepPenalty"+team).checked) oth-=15;
  if(document.getElementById("fallenTrees"+team).checked) oth-=10;
  document.getElementById("total"+team).textContent=rec+ref+oth;
  return rec+ref+oth;
}

document.querySelectorAll("input,select").forEach(el=>el.addEventListener("change", ()=>{calc(1);calc(2);})); 

function loadEntries(){ return JSON.parse(localStorage.getItem('madbot')||"[]"); }
function saveEntries(d){ localStorage.setItem('madbot',JSON.stringify(d)); }

function refreshTable(){ 
  let tb=document.querySelector("#table tbody"); 
  tb.innerHTML="";
  let data = loadEntries();
  data.sort((a,b)=>b.total-a.total);
  data.forEach((e,i)=>{ 
    let tr=document.createElement("tr"); 
    tr.innerHTML=`<td>${i+1}</td><td>${e.team}</td><td>${e.cat}</td><td>${e.round}</td><td>${e.total}</td><td><button onclick="deleteRow(${i})">Borrar</button></td>`; 
    tb.appendChild(tr); 
  });
}

function deleteRow(index){ let data=loadEntries(); data.splice(index,1); saveEntries(data); refreshTable(); }

document.getElementById("save").onclick=()=>{
  [1,2].forEach(t=>{
    let entry={ team:document.getElementById("team"+t+"_name").value, cat:document.getElementById("team"+t+"_cat").value, round:document.getElementById("team"+t+"_round").value, total:calc(t) };
    let data=loadEntries(); data.push(entry); saveEntries(data);
  });
  refreshTable();
};

document.getElementById("export").onclick=()=>{
  let data=loadEntries(); if(!data.length){alert("No hay datos");return;}
  let csv="Puesto,Equipo,Categoría,Ronda,Total\n"+data.map((e,i)=>[i+1,e.team,e.cat,e.round,e.total].join(",")).join("\n");
  let blob=new Blob([csv],{type:"text/csv"}); let a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="madbot.csv"; a.click();
};

document.getElementById("reset").onclick=()=>{ localStorage.removeItem("madbot"); refreshTable(); resetTeam(1); resetTeam(2); resetPrep(); resetMain(); };

// Clasificación final acumulada
document.getElementById("finalScoresBtn").onclick=()=>{
  let data=loadEntries();
  let finalScores = {};
  data.forEach(e=>{
    if(!finalScores[e.team]) finalScores[e.team]={team:e.team, cat:e.cat, total:0, rounds:0};
    finalScores[e.team].total += e.total;
    finalScores[e.team].rounds += 1;
  });
  let finalArray = Object.values(finalScores).sort((a,b)=>b.total-a.total);
  let tb = document.querySelector("#finalTable tbody");
  tb.innerHTML = "";
  finalArray.forEach((e,i)=>{
    let tr = document.createElement("tr");
    tr.innerHTML = `<td>${i+1}</td><td>${e.team}</td><td>${e.cat}</td><td>${e.rounds}</td><td>${e.total}</td>`;
    tb.appendChild(tr);
  });
};

refreshTable(); calc(1); calc(2);
</script>
</body>
</html>


